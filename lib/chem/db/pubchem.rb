#
# chem/db/pubchem.rb - PubChem database class
#
#   Copyright (C) 2005-2007 TANAKA   Nobuya  <nobuya.tanaka@gmail.com>
#

require 'chem'
# ftp://ftp.ncbi.nlm.nih.gov/pubchem/specifications/pubchem_fingerprints.txt

module Chem
  # Section 1.
  HierarchicElementCounts = {
    :H => [
      [4, 0],
      [8, 1],
      [16, 2],
      [32, 3]],
    :Li => [
      [ 1, 4],
      [ 2, 5]],
    :B => [
      [ 1, 6],
      [ 2, 7],
      [ 4, 8]],
    :C => [
      [ 2, 9],
      [ 4, 10],
      [ 8, 11],
      [ 16, 12],
      [ 32, 13]],
    :N => [
      [ 1, 14],
      [ 2, 15],
      [ 4, 16],
      [ 8, 17]],
    :O => [
      [ 1, 18],
      [ 2, 19],
      [ 4, 20],
      [ 8, 21],
      [ 16, 22]],
    :F => [
      [ 1, 23],
      [ 2, 24],
      [ 4, 25]],
    :Na => [
      [ 1, 26],
      [ 2, 27]],
    :Si => [
      [ 1, 28],
      [ 2, 29]],
    :P => [
      [ 1, 30],
      [ 2, 31],
      [ 4, 32]],
    :S => [
      [ 1, 33],
      [ 2, 34],
      [ 4, 35],
      [ 8, 36]],
    :Cl => [
      [ 1, 37],
      [ 2, 38],
      [ 4, 39],
      [ 8, 40]],
    :K => [
      [ 1, 41],
      [ 2, 42]],
    :Br => [
      [ 1, 43],
      [ 2, 44],
      [ 4, 45]],
    :I => [
      [ 1, 46],
      [ 2, 47],
      [ 4, 48]],
    :Be => [[ 1, 49 ]],
    :Mg => [[ 1, 50]],
    :Al => [[ 1, 51]],
    :Ca => [[ 1, 52]],
    :Sc => [[ 1, 53]],
    :Ti => [[ 1, 54]],
    :V => [[ 1, 55]],
    :Cr => [[ 1, 56]],
    :Mn => [[ 1, 57]],
    :Fe => [[ 1, 58]],
    :Co => [[ 1, 59]],
    :Ni => [[ 1, 60]],
    :Cu => [[ 1, 61]],
    :Zn => [[ 1, 62]],
    :Ga => [[ 1, 63]],
    :Ge => [[ 1, 64]],
    :As => [[ 1, 65]],
    :Se => [[ 1, 66]],
    :Kr => [[ 1, 67]],
    :Rb => [[ 1, 68]],
    :Sr => [[ 1, 69]],
    :Y => [[ 1, 70]],
    :Zr => [[ 1, 71]],
    :Nb => [[ 1, 72]],
    :Mo => [[ 1, 73]],
    :Ru => [[ 1, 74]],
    :Rh => [[ 1, 75]],
    :Pd => [[ 1, 76]],
    :Ag => [[ 1, 77]],
    :Cd => [[ 1, 78]],
    :In => [[ 1, 79]],
    :Sn => [[ 1, 80]],
    :Sb => [[ 1, 81]],
    :Te => [[ 1, 82]],
    :Xe => [[ 1, 83]],
    :Cs => [[ 1, 84]],
    :Ba => [[ 1, 85]],
    :Lu => [[ 1, 86]],
    :Hf => [[ 1, 87]],
    :Ta => [[ 1, 88]],
    :W => [[ 1, 89]],
    :Re => [[ 1, 90]],
    :Os => [[ 1, 91]],
    :Ir => [[ 1, 92]],
    :Pt => [[ 1, 93]],
    :Au => [[ 1, 94]],
    :Hg => [[ 1, 95]],
    :Tl => [[ 1, 96]],
    :Pb => [[ 1, 97]],
    :Bi => [[ 1, 98]],
    :La => [[ 1, 99]],
    :Ce => [[ 1, 100]],
    :Pr => [[ 1, 101]],
    :Nd => [[ 1, 102]],
    :Pm => [[ 1, 103]],
    :Sm => [[ 1, 104]],
    :Eu => [[ 1, 105]],
    :Gd => [[ 1, 106]],
    :Tb => [[ 1, 107]],
    :Dy => [[ 1, 108]],
    :Ho => [[ 1, 109]],
    :Er => [[ 1, 110]],
    :Tm => [[ 1, 111]],
    :Yb => [[ 1, 112]],
    :Tc => [[ 1, 113]],
    :U => [[ 1, 114]],
  }

  # Section 2

  # Section 3
  Section3 = {
    'H-Li'  => 263,
    'Li-Li' => 264,
    'B-Li'  => 265,
    'C-Li'  => 266,
    'Li-O'  => 267,
    'F-Li'  => 268,
    'Li-P'  => 269,
    'Li-S'  => 270,
    'Cl-Li' => 271,
    'B-H'   => 272,
    'B-B'   => 273,
    'B-C'   => 274,
    'B-N'   => 275,
    'B-O'   => 276,
    'B-F'   => 277,
    'B-Si'  => 278,
    'B-P'   => 279,
    'B-S'   => 280,
    'B-Cl'  => 281,
    'B-Br'  => 282,
    'C-H'   => 283,
    'C-C'   => 284,
    'C-N'   => 285,
    'C-O'   => 286,
    'C-F'   => 287,
    'C-Na'  => 288,
    'C-Mg'  => 289,
    'Al-C'  => 290,
    'C-Si'  => 291,
    'C-P'   => 292,
    'C-S'   => 293,
    'C-Cl'  => 294,
    'As-C'  => 295,
    'C-Se'  => 296,
    'Br-C'  => 297,
    'C-I'   => 298,
    'H-N'   => 299,
    'N-N'   => 300,
    'N-O'   => 301,
    'F-N'   => 302,
    'N-Si'  => 303,
    'N-P'   => 304,
    'N-S'   => 305,
    'Cl-N'  => 306,
    'Br-N'  => 307,
    'H-O'   => 308,
    'O-O'   => 309,
    'Mg-O'  => 310,
    'Na-O'  => 311,
    'Al-O'  => 312,
    'O-Si'  => 313,
    'O-P'   => 314,
    'K-O'   => 315,
    'F-P'   => 316,
    'F-S'   => 317,
    'Al-H'  => 318,
    'Al-Cl' => 319,
    'H-Si'  => 320,
    'Si-Si' => 321,
    'Cl-Si' => 322,
    'H-P'   => 323,
    'P-P'   => 324,
    'As-H'  => 325,
    'As-As' => 326,
  }

  # Section 4 Simple atom nearest neighbors

  Section4 = {
    :C => [
      ["-Br", "-C", 327],
      ["-Br", "-C", "-C", 328],
      ["-Br", "-H", 329],
      ["-Br", "~C", 330],
      ["-Br", "~N", 331],
      ["-C", "-C", 332],
      ["-C", "-C", "-C", 333],
      ["-C", "-C", "-C", "-C", 334],
      ["-C", "-C", "-C", "-H", 335],
      ["-C", "-C", "-C", "-N", 336],
      ["-C", "-C", "-C", "-O", 337],
      ["-C", "-C", "-H", "-N", 338],
      ["-C", "-C", "-H", "-O", 339],
      ["-C", "-C", "-N", 340],
      ["-C", "-C", "-O", 341],
      ["-C", "-Cl", 342],
      ["-C", "-Cl", "-H", 343],
      ["-C", "-H", 344],
      ["-C", "-H", "-N", 345],
      ["-C", "-H", "-O", 346],
      ["-C", "-H", "-O", "-O", 347],
      ["-C", "-H", "-P", 348],
      ["-C", "-H", "-S", 349],
      ["-C", "-I", 350],
      ["-C", "-N", 351],
      ["-C", "-O", 352],
      ["-C", "-S", 353],
      ["-C", "-Si", 354],
      ["-C", "~C", 355],
      ["-C", "~C", "~C", 356],
      ["-C", "~C", "~N", 357],
      ["-C", "~N", 358],
      ["-C", "~N", "~N", 359],
      ["-Cl", "-Cl", 360],
      ["-Cl", "-H", 361],
      ["-Cl", "~C", 362],
      ["-F", "-F", 363],
      ["-F", "~C", 364],
      ["-H", "-N", 365],
      ["-H", "-O", 366],
      ["-H", "-O", "-O", 367],
      ["-H", "-S", 368],
      ["-H", "-Si", 369],
      ["-H", "~C", 370],
      ["-H", "~C", "~C", 371],
      ["-H", "~C", "~N", 372],
      ["-H", "~N", 373],
      ["-H", "-H", "-H", 374],
      ["-N", "-N", 375],
      ["-N", "~C", 376],
      ["-N", "~C", "~C", 377],
      ["-N", "~C", "~N", 378],
      ["-N", "~N", 379],
      ["-O", "-O", 380],
      ["-O", "~C", 381],
      ["-O", "~C", "~C", 382],
      ["-S", "~C", 383],
      ["~C", "~C", 384],
      ["~C", "~C", "~C", 385],
      ["~C", "~C", "~N", 386],
      ["~C", "~N", 387],
      ["~C", "~N", "~N", 388],
      ["~N", "~N", 389]],
    :N => [
      ["-C", "-C", 390],
      ["-C", "-C", "-C", 391],
      ["-C", "-C", "-H", 392],
      ["-C", "-H", 393],
      ["-C", "-H", "-N", 394],
      ["-C", "-O", 395],
      ["-C", "~C", 396],
      ["-C", "~C", "~C", 397],
      ["-H", "-N", 398],
      ["-H", "~C", 399],
      ["-H", "~C", "~C", 400],
      ["-O", "-O", 401],
      ["-O", "~O", 402],
      ["~C", "~C", 403],
      ["~C", "~C", "~C", 404]],
    :O => [
      ["-C", "-C", 405],
      ["-C", "-H", 406],
      ["-C", "-P", 407],
      ["-H", "-S", 408],
      ["~C", "~C", 409]],
    :P => [
      ["-C", "-C", 410],
      ["-O", "-O", 411]],
    :S => [
      ["-C", "-C", 412],
      ["-C", "-H", 413],
      ["-C", "-O", 414]],
    :Si => [
      ["-C", "-C", 415]
    ]
  }



  # Section 5 Detailed atom neighborhoods

  # Section 6 Simple SMARTS patterns

  Section6 = {
    "C-C-C#C" => 460,
    "O-C-C=N" => 461,
    "O-C-C=O" => 462,
    "N:C-S-[#1]" => 463,
    "N-C-C=C" => 464,
    "O=S-C-C" => 465,
    "N#C-C=C" => 466,
    "C=N-N-C" => 467,
    "O=S-C-N" => 468,
    "S-S-C:C" => 469,
    "C:C-C=C" => 470,
    "S:C:C:C" => 471,
    "C:N:C-C" => 472,
    "S-C:N:C" => 473,
    "S:C:C:N" => 474,
    "S-C=N-C" => 475,
    "C-O-C=C" => 476,
    "N-N-C:C" => 477,
    "S-C=N-[#1]" => 478,
    "S-C-S-C" => 479,
    "C:S:C-C" => 480,
    "O-S-C:C" => 481,
    "C:N-C:C" => 482,
    "N-S-C:C" => 483,
    "N-C:N:C" => 484,
    "N:C:C:N" => 485,
    "N-C:N:N" => 486,
    "N-C=N-C" => 487,
    "N-C=N-[#1]" => 488,
    "N-C-S-C" => 489,
    "C-C-C=C" => 490,
    "C-N:C-[#1]" => 491,
    "N-C:O:C" => 492,
    "O=C-C:C" => 493,
    "O=C-C:N" => 494,
    "C-N-C:C" => 495,
    "N:N-C-[#1]" => 496,
    "O-C:C:N" => 497,
    "O-C=C-C" => 498,
    "N-C:C:N" => 499,
    "C-S-C:C" => 500,
    "Cl-C:C-C" => 501,
    "N-C=C-[#1]" => 502,
    "Cl-C:C-[#1]" => 503,
    "N:C:N-C" => 504,
    "Cl-C:C-O" => 505,
    "C-C:N:C" => 506,
    "C-C-S-C" => 507,
    "S=C-N-C" => 508,
    "Br-C:C-C" => 509,
    "[#1]-N-N-[#1]" => 510,
    "S=C-N-[#1]" => 511,
    "C-[As]-O-[#1]" => 512,
    "S:C:C-[#1]" => 513,
    "O-N-C-C" => 514,
    "N-N-C-C" => 515,
    "[#1]-C=C-[#1]" => 516,
    "N-N-C-N" => 517,
    "O=C-N-N" => 518,
    "N=C-N-C" => 519,
    "C=C-C:C" => 520,
    "C:N-C-[#1]" => 521,
    "C-N-N-[#1]" => 522,
    "N:C:C-C" => 523,
    "C-C=C-C" => 524,
    "[As]-C:C-[#1]" => 525,
    "Cl-C:C-Cl" => 526,
    "C:C:N-[#1]" => 527,
    "[#1]-N-C-[#1]" => 528,
    "Cl-C-C-Cl" => 529,
    "N:C-C:C" => 530,
    "S-C:C-C" => 531,
    "S-C:C-[#1]" => 532,
    "S-C:C-N" => 533,
    "S-C:C-O" => 534,
    "O=C-C-C" => 535,
    "O=C-C-N" => 536,
    "O=C-C-O" => 537,
    "N=C-C-C" => 538,
    "N=C-C-[#1]" => 539,
    "C-N-C-[#1]" => 540,
    "O-C:C-C" => 541,
    "O-C:C-[#1]" => 542,
    "O-C:C-N" => 543,
    "O-C:C-O" => 544,
    "N-C:C-C" => 545,
    "N-C:C-[#1]" => 546,
    "N-C:C-N" => 547,
    "O-C-C:C" => 548,
    "N-C-C:C" => 549,
    "Cl-C-C-C" => 550,
    "Cl-C-C-O" => 551,
    "C:C-C:C" => 552,
    "O=C-C=C" => 553,
    "Br-C-C-C" => 554,
    "N=C-C=C" => 555,
    "C=C-C-C" => 556,
    "N:C-O-[#1]" => 557,
    "O=N-C:C" => 558,
    "O-C-N-[#1]" => 559,
    "N-C-N-C" => 560,
    "Cl-C-C=O" => 561,
    "Br-C-C=O" => 562,
    "O-C-O-C" => 563,
    "C=C-C=C" => 564,
    "C:C-O-C" => 565,
    "O-C-C-N" => 566,
    "O-C-C-O" => 567,
    "N#C-C-C" => 568,
    "N-C-C-N" => 569,
    "C:C-C-C" => 570,
    "[#1]-C-O-[#1]" => 571,
    "N:C:N:C" => 572,
    "O-C-C=C" => 573,
    "O-C-C:C-C" => 574,
    "O-C-C:C-O" => 575,
    "N=C-C:C-[#1]" => 576,
    "C:C-N-C:C" => 577,
    "C-C:C-C:C" => 578,
    "O=C-C-C-C" => 579,
    "O=C-C-C-N" => 580,
    "O=C-C-C-O" => 581,
    "C-C-C-C-C" => 582,
    "Cl-C:C-O-C" => 583,
    "C:C-C=C-C" => 584,
    "C-C:C-N-C" => 585,
    "C-S-C-C-C" => 586,
    "N-C:C-O-[#1]" => 587,
    "O=C-C-C=O" => 588,
    "C-C:C-O-C" => 589,
    "C-C:C-O-[#1]" => 590,
    "Cl-C-C-C-C" => 591,
    "N-C-C-C-C" => 592,
    "N-C-C-C-N" => 593,
    "C-O-C-C=C" => 594,
    "C:C-C-C-C" => 595,
    "N=C-N-C-C" => 596,
    "O=C-C-C:C" => 597,
    "Cl-C:C:C-C" => 598,
    "[#1]-C-C=C-[#1]" => 599,
    "N-C:C:C-C" => 600,
    "N-C:C:C-N" => 601,
    "O=C-C-N-C" => 602,
    "C-C:C:C-C" => 603,
    "C-O-C-C:C" => 604,
    "O=C-C-O-C" => 605,
    "O-C:C-C-C" => 606,
    "N-C-C-C:C" => 607,
    "C-C-C-C:C" => 608,
    "Cl-C-C-N-C" => 609,
    "C-O-C-O-C" => 610,
    "N-C-C-N-C" => 611,
    "N-C-O-C-C" => 612,
    "C-N-C-C-C" => 613,
    "C-C-O-C-C" => 614,
    "N-C-C-O-C" => 615,
    "C:C:N:N:C" => 616,
    "C-C-C-O-[#1]" => 617,
    "C:C-C-C:C" => 618,
    "O-C-C=C-C" => 619,
    "C:C-O-C-C" => 620,
    "N-C:C:C:N" => 621,
    "O=C-O-C:C" => 622,
    "O=C-C:C-C" => 623,
    "O=C-C:C-N" => 624,
    "O=C-C:C-O" => 625,
    "C-O-C:C-C" => 626,
    "O=[As]-C:C:C" => 627,
    "C-N-C-C:C" => 628,
    "S-C:C:C-N" => 629,
    "O-C:C-O-C" => 630,
    "O-C:C-O-[#1]" => 631,
    "C-C-O-C:C" => 632,
    "N-C-C:C-C" => 633,
    "C-C-C:C-C" => 634,
    "N-N-C-N-[#1]" => 635,
    "C-N-C-N-C" => 636,
    "O-C-C-C-C" => 637,
    "O-C-C-C-N" => 638,
    "O-C-C-C-O" => 639,
    "C=C-C-C-C" => 640,
    "O-C-C-C=C" => 641,
    "O-C-C-C=O" => 642,
    "[#1]-C-C-N-[#1]" => 643,
    "C-C=N-N-C" => 644,
    "O=C-N-C-C" => 645,
    "O=C-N-C-[#1]" => 646,
    "O=C-N-C-N" => 647,
    "O=N-C:C-N" => 648,
    "O=N-C:C-O" => 649,
    "O=C-N-C=O" => 650,
    "O-C:C:C-C" => 651,
    "O-C:C:C-N" => 652,
    "O-C:C:C-O" => 653,
    "N-C-N-C-C" => 654,
    "O-C-C-C:C" => 655,
    "C-C-N-C-C" => 656,
    "C-N-C:C-C" => 657,
    "C-C-S-C-C" => 658,
    "O-C-C-N-C" => 659,
    "C-C=C-C-C" => 660,
    "O-C-O-C-C" => 661,
    "O-C-C-O-C" => 662,
    "O-C-C-O-[#1]" => 663,
    "C-C=C-C=C" => 664,
    "N-C:C-C-C" => 665,
    "C=C-C-O-C" => 666,
    "C=C-C-O-[#1]" => 667,
    "C-C:C-C-C" => 668,
    "Cl-C:C-C=O" => 669,
    "Br-C:C:C-C" => 670,
    "O=C-C=C-C" => 671,
    "O=C-C=C-[#1]" => 672,
    "O=C-C=C-N" => 673,
    "N-C-N-C:C" => 674,
    "Br-C-C-C:C" => 675,
    "N#C-C-C-C" => 676,
    "C-C=C-C:C" => 677,
    "C-C-C=C-C" => 678,
    "C-C-C-C-C-C" => 679,
    "O-C-C-C-C-C" => 680,
    "O-C-C-C-C-O" => 681,
    "O-C-C-C-C-N" => 682,
    "N-C-C-C-C-C" => 683,
    "O=C-C-C-C-C" => 684,
    "O=C-C-C-C-N" => 685,
    "O=C-C-C-C-O" => 686,
    "O=C-C-C-C=O" => 687,
    "C-C-C-C-C-C-C" => 688,
    "O-C-C-C-C-C-C" => 689,
    "O-C-C-C-C-C-O" => 690,
    "O-C-C-C-C-C-N" => 691,
    "O=C-C-C-C-C-C" => 692,
    "O=C-C-C-C-C-O" => 693,
    "O=C-C-C-C-C=O" => 694,
    "O=C-C-C-C-C-N" => 695,
    "C-C-C-C-C-C-C-C" => 696,
    "C-C-C-C-C-C(C)-C" => 697,
    "O-C-C-C-C-C-C-C" => 698,
    "O-C-C-C-C-C(C)-C" => 699,
    "O-C-C-C-C-C-O-C" => 700,
    "O-C-C-C-C-C(O)-C" => 701,
    "O-C-C-C-C-C-N-C" => 702,
    "O-C-C-C-C-C(N)-C" => 703,
    "O=C-C-C-C-C-C-C" => 704,
    "O=C-C-C-C-C(O)-C" => 705,
    "O=C-C-C-C-C(=O)-C" => 706,
    "O=C-C-C-C-C(N)-C" => 707,
    "C-C(C)-C-C" => 708,
    "C-C(C)-C-C-C" => 709,
    "C-C-C(C)-C-C" => 710,
    "C-C(C)(C)-C-C" => 711,
    "C-C(C)-C(C)-C" => 712,
  }

  # Section 7: Complex SMARTS patterns

  Section7 = {
    "Cc1ccc(C)cc1" => 713,
    "Cc1ccc(O)cc1" => 714,
    "Cc1ccc(S)cc1" => 715,
    "Cc1ccc(N)cc1" => 716,
    "Cc1ccc(Cl)cc1" => 717,
    "Cc1ccc(Br)cc1" => 718,
    "Oc1ccc(O)cc1" => 719,
    "Oc1ccc(S)cc1" => 720,
    "Oc1ccc(N)cc1" => 721,
    "Oc1ccc(Cl)cc1" => 722,
    "Oc1ccc(Br)cc1" => 723,
    "Sc1ccc(S)cc1" => 724,
    "Sc1ccc(N)cc1" => 725,
    "Sc1ccc(Cl)cc1" => 726,
    "Sc1ccc(Br)cc1" => 727,
    "Nc1ccc(N)cc1" => 728,
    "Nc1ccc(Cl)cc1" => 729,
    "Nc1ccc(Br)cc1" => 730,
    "Clc1ccc(Cl)cc1" => 731,
    "Clc1ccc(Br)cc1" => 732,
    "Brc1ccc(Br)cc1" => 733,
    "Cc1cc(C)ccc1" => 734,
    "Cc1cc(O)ccc1" => 735,
    "Cc1cc(S)ccc1" => 736,
    "Cc1cc(N)ccc1" => 737,
    "Cc1cc(Cl)ccc1" => 738,
    "Cc1cc(Br)ccc1" => 739,
    "Oc1cc(O)ccc1" => 740,
    "Oc1cc(S)ccc1" => 741,
    "Oc1cc(N)ccc1" => 742,
    "Oc1cc(Cl)ccc1" => 743,
    "Oc1cc(Br)ccc1" => 744,
    "Sc1cc(S)ccc1" => 745,
    "Sc1cc(N)ccc1" => 746,
    "Sc1cc(Cl)ccc1" => 747,
    "Sc1cc(Br)ccc1" => 748,
    "Nc1cc(N)ccc1" => 749,
    "Nc1cc(Cl)ccc1" => 750,
    "Nc1cc(Br)ccc1" => 751,
    "Clc1cc(Cl)ccc1" => 752,
    "Clc1cc(Br)ccc1" => 753,
    "Brc1cc(Br)ccc1" => 754,
    "Cc1c(C)cccc1" => 755,
    "Cc1c(O)cccc1" => 756,
    "Cc1c(S)cccc1" => 757,
    "Cc1c(N)cccc1" => 758,
    "Cc1c(Cl)cccc1" => 759,
    "Cc1c(Br)cccc1" => 760,
    "Oc1c(O)cccc1" => 761,
    "Oc1c(S)cccc1" => 762,
    "Oc1c(N)cccc1" => 763,
    "Oc1c(Cl)cccc1" => 764,
    "Oc1c(Br)cccc1" => 765,
    "Sc1c(S)cccc1" => 766,
    "Sc1c(N)cccc1" => 767,
    "Sc1c(Cl)cccc1" => 768,
    "Sc1c(Br)cccc1" => 769,
    "Nc1c(N)cccc1" => 770,
    "Nc1c(Cl)cccc1" => 771,
    "Nc1c(Br)cccc1" => 772,
    "Clc1c(Cl)cccc1" => 773,
    "Clc1c(Br)cccc1" => 774,
    "Brc1c(Br)cccc1" => 775,
    "CC1CCC(C)CC1" => 776,
    "CC1CCC(O)CC1" => 777,
    "CC1CCC(S)CC1" => 778,
    "CC1CCC(N)CC1" => 779,
    "CC1CCC(Cl)CC1" => 780,
    "CC1CCC(Br)CC1" => 781,
    "OC1CCC(O)CC1" => 782,
    "OC1CCC(S)CC1" => 783,
    "OC1CCC(N)CC1" => 784,
    "OC1CCC(Cl)CC1" => 785,
    "OC1CCC(Br)CC1" => 786,
    "SC1CCC(S)CC1" => 787,
    "SC1CCC(N)CC1" => 788,
    "SC1CCC(Cl)CC1" => 789,
    "SC1CCC(Br)CC1" => 790,
    "NC1CCC(N)CC1" => 791,
    "NC1CCC(Cl)CC1" => 792,
    "NC1CCC(Br)CC1" => 793,
    "ClC1CCC(Cl)CC1" => 794,
    "ClC1CCC(Br)CC1" => 795,
    "BrC1CCC(Br)CC1" => 796,
    "CC1CC(C)CCC1" => 797,
    "CC1CC(O)CCC1" => 798,
    "CC1CC(S)CCC1" => 799,
    "CC1CC(N)CCC1" => 800,
    "CC1CC(Cl)CCC1" => 801,
    "CC1CC(Br)CCC1" => 802,
    "OC1CC(O)CCC1" => 803,
    "OC1CC(S)CCC1" => 804,
    "OC1CC(N)CCC1" => 805,
    "OC1CC(Cl)CCC1" => 806,
    "OC1CC(Br)CCC1" => 807,
    "SC1CC(S)CCC1" => 808,
    "SC1CC(N)CCC1" => 809,
    "SC1CC(Cl)CCC1" => 810,
    "SC1CC(Br)CCC1" => 811,
    "NC1CC(N)CCC1" => 812,
    "NC1CC(Cl)CCC1" => 813,
    "NC1CC(Br)CCC1" => 814,
    "ClC1CC(Cl)CCC1" => 815,
    "ClC1CC(Br)CCC1" => 816,
    "BrC1CC(Br)CCC1" => 817,
    "CC1C(C)CCCC1" => 818,
    "CC1C(O)CCCC1" => 819,
    "CC1C(S)CCCC1" => 820,
    "CC1C(N)CCCC1" => 821,
    "CC1C(Cl)CCCC1" => 822,
    "CC1C(Br)CCCC1" => 823,
    "OC1C(O)CCCC1" => 824,
    "OC1C(S)CCCC1" => 825,
    "OC1C(N)CCCC1" => 826,
    "OC1C(Cl)CCCC1" => 827,
    "OC1C(Br)CCCC1" => 828,
    "SC1C(S)CCCC1" => 829,
    "SC1C(N)CCCC1" => 830,
    "SC1C(Cl)CCCC1" => 831,
    "SC1C(Br)CCCC1" => 832,
    "NC1C(N)CCCC1" => 833,
    "NC1C(Cl)CCCC1" => 834,
    "NC1C(Br)CCCC1" => 835,
    "ClC1C(Cl)CCCC1" => 836,
    "ClC1C(Br)CCCC1" => 837,
    "BrC1C(Br)CCCC1" => 838,
    "CC1CC(C)CC1" => 839,
    "CC1CC(O)CC1" => 840,
    "CC1CC(S)CC1" => 841,
    "CC1CC(N)CC1" => 842,
    "CC1CC(Cl)CC1" => 843,
    "CC1CC(Br)CC1" => 844,
    "OC1CC(O)CC1" => 845,
    "OC1CC(S)CC1" => 846,
    "OC1CC(N)CC1" => 847,
    "OC1CC(Cl)CC1" => 848,
    "OC1CC(Br)CC1" => 849,
    "SC1CC(S)CC1" => 850,
    "SC1CC(N)CC1" => 851,
    "SC1CC(Cl)CC1" => 852,
    "SC1CC(Br)CC1" => 853,
    "NC1CC(N)CC1" => 854,
    "NC1CC(Cl)CC1" => 855,
    "NC1CC(Br)CC1" => 856,
    "ClC1CC(Cl)CC1" => 857,
    "ClC1CC(Br)CC1" => 858,
    "BrC1CC(Br)CC1" => 859,
    "CC1C(C)CCC1" => 860,
    "CC1C(O)CCC1" => 861,
    "CC1C(S)CCC1" => 862,
    "CC1C(N)CCC1" => 863,
    "CC1C(Cl)CCC1" => 864,
    "CC1C(Br)CCC1" => 865,
    "OC1C(O)CCC1" => 866,
    "OC1C(S)CCC1" => 867,
    "OC1C(N)CCC1" => 868,
    "OC1C(Cl)CCC1" => 869,
    "OC1C(Br)CCC1" => 870,
    "SC1C(S)CCC1" => 871,
    "SC1C(N)CCC1" => 872,
    "SC1C(Cl)CCC1" => 873,
    "SC1C(Br)CCC1" => 874,
    "NC1C(N)CCC1" => 875,
    "NC1C(Cl)CC1" => 876,
    "NC1C(Br)CCC1" => 877,
    "ClC1C(Cl)CCC1" => 878,
    "ClC1C(Br)CCC1" => 879,
    "BrC1C(Br)CCC1" => 880,
  }

  PubChemSubsKey = [
    ">= 4 H",
    ">= 8 H",
    ">= 16 H",
    ">= 32 H",
    ">= 1 Li",
    ">= 2 Li",
    ">= 1 B",
    ">= 2 B",
    ">= 4 B",
    ">= 2 C",
    ">= 4 C",
    ">= 8 C",
    ">= 16 C",
    ">= 32 C",
    ">= 1 N",
    ">= 2 N",
    ">= 4 N",
    ">= 8 N",
    ">= 1 O",
    ">= 2 O",
    ">= 4 O",
    ">= 8 O",
    ">= 16 O",
    ">= 1 F",
    ">= 2 F",
    ">= 4 F",
    ">= 1 Na",
    ">= 2 Na",
    ">= 1 Si",
    ">= 2 Si",
    ">= 1 P",
    ">= 2 P",
    ">= 4 P",
    ">= 1 S",
    ">= 2 S",
    ">= 4 S",
    ">= 8 S",
    ">= 1 Cl",
    ">= 2 Cl",
    ">= 4 Cl",
    ">= 8 Cl",
    ">= 1 K",
    ">= 2 K",
    ">= 1 Br",
    ">= 2 Br",
    ">= 4 Br",
    ">= 1 I",
    ">= 2 I",
    ">= 4 I",
    ">= 1 Be",
    ">= 1 Mg",
    ">= 1 Al",
    ">= 1 Ca",
    ">= 1 Sc",
    ">= 1 Ti",
    ">= 1 V",
    ">= 1 Cr",
    ">= 1 Mn",
    ">= 1 Fe",
    ">= 1 Co",
    ">= 1 Ni",
    ">= 1 Cu",
    ">= 1 Zn",
    ">= 1 Ga",
    ">= 1 Ge",
    ">= 1 As",
    ">= 1 Se",
    ">= 1 Kr",
    ">= 1 Rb",
    ">= 1 Sr",
    ">= 1 Y",
    ">= 1 Zr",
    ">= 1 Nb",
    ">= 1 Mo",
    ">= 1 Ru",
    ">= 1 Rh",
    ">= 1 Pd",
    ">= 1 Ag",
    ">= 1 Cd",
    ">= 1 In",
    ">= 1 Sn",
    ">= 1 Sb",
    ">= 1 Te",
    ">= 1 Xe",
    ">= 1 Cs",
    ">= 1 Ba",
    ">= 1 Lu",
    ">= 1 Hf",
    ">= 1 Ta",
    ">= 1 W",
    ">= 1 Re",
    ">= 1 Os",
    ">= 1 Ir",
    ">= 1 Pt",
    ">= 1 Au",
    ">= 1 Hg",
    ">= 1 Tl",
    ">= 1 Pb",
    ">= 1 Bi",
    ">= 1 La",
    ">= 1 Ce",
    ">= 1 Pr",
    ">= 1 Nd",
    ">= 1 Pm",
    ">= 1 Sm",
    ">= 1 Eu",
    ">= 1 Gd",
    ">= 1 Tb",
    ">= 1 Dy",
    ">= 1 Ho",
    ">= 1 Er",
    ">= 1 Tm",
    ">= 1 Yb",
    ">= 1 Tc",
    ">= 1 U",
    ">= 1 any ring size 3",
    ">= 1 saturated carbon-only ring size 3",
    ">= 1 saturated nitrogen-containing ring size 3",
    ">= 1 saturated heteroatom-containing ring size 3",
    ">= 1 unsaturated or aromatic carbon-only ring size 3",
    ">= 1 unsaturated or aromatic nitrogen-containing ring size 3",
    ">= 1 unsaturated or aromatic heteroatom-containing ring size 3",
    ">= 2 any ring size 3",
    ">= 2 saturated carbon-only ring size 3",
    ">= 2 saturated nitrogen-containing ring size 3",
    ">= 2 saturated heteroatom-containing ring size 3",
    ">= 2 unsaturated or aromatic carbon-only ring size 3",
    ">= 2 unsaturated or aromatic nitrogen-containing ring size 3",
    ">= 2 unsaturated or aromatic heteroatom-containing ring size 3",
    ">= 1 any ring size 4",
    ">= 1 saturated carbon-only ring size 4",
    ">= 1 saturated nitrogen-containing ring size 4",
    ">= 1 saturated heteroatom-containing ring size 4",
    ">= 1 unsaturated or aromatic carbon-only ring size 4",
    ">= 1 unsaturated or aromatic nitrogen-containing ring size 4",
    ">= 1 unsaturated or aromatic heteroatom-containing ring size 4",
    ">= 2 any ring size 4",
    ">= 2 saturated carbon-only ring size 4",
    ">= 2 saturated nitrogen-containing ring size 4",
    ">= 2 saturated heteroatom-containing ring size 4",
    ">= 2 unsaturated or aromatic carbon-only ring size 4",
    ">= 2 unsaturated or aromatic nitrogen-containing ring size 4",
    ">= 2 unsaturated or aromatic heteroatom-containing ring size 4",
    ">= 1 any ring size 5",
    ">= 1 saturated carbon-only ring size 5",
    ">= 1 saturated nitrogen-containing ring size 5",
    ">= 1 saturated heteroatom-containing ring size 5",
    ">= 1 unsaturated or aromatic carbon-only ring size 5",
    ">= 1 unsaturated or aromatic nitrogen-containing ring size 5",
    ">= 1 unsaturated or aromatic heteroatom-containing ring size 5",
    ">= 2 any ring size 5",
    ">= 2 saturated carbon-only ring size 5",
    ">= 2 saturated nitrogen-containing ring size 5",
    ">= 2 saturated heteroatom-containing ring size 5",
    ">= 2 unsaturated or aromatic carbon-only ring size 5",
    ">= 2 unsaturated or aromatic nitrogen-containing ring size 5",
    ">= 2 unsaturated or aromatic heteroatom-containing ring size 5",
    ">= 3 any ring size 5",
    ">= 3 saturated carbon-only ring size 5",
    ">= 3 saturated nitrogen-containing ring size 5",
    ">= 3 saturated heteroatom-containing ring size 5",
    ">= 3 unsaturated or aromatic carbon-only ring size 5",
    ">= 3 unsaturated or aromatic nitrogen-containing ring size 5",
    ">= 3 unsaturated or aromatic heteroatom-containing ring size 5",
    ">= 4 any ring size 5",
    ">= 4 saturated carbon-only ring size 5",
    ">= 4 saturated nitrogen-containing ring size 5",
    ">= 4 saturated heteroatom-containing ring size 5",
    ">= 4 unsaturated or aromatic carbon-only ring size 5",
    ">= 4 unsaturated or aromatic nitrogen-containing ring size 5",
    ">= 4 unsaturated or aromatic heteroatom-containing ring size 5",
    ">= 5 any ring size 5",
    ">= 5 saturated carbon-only ring size 5",
    ">= 5 saturated nitrogen-containing ring size 5",
    ">= 5 saturated heteroatom-containing ring size 5",
    ">= 5 unsaturated or aromatic carbon-only ring size 5",
    ">= 5 unsaturated or aromatic nitrogen-containing ring size 5",
    ">= 5 unsaturated or aromatic heteroatom-containing ring size 5",
    ">= 1 any ring size 6",
    ">= 1 saturated carbon-only ring size 6",
    ">= 1 saturated nitrogen-containing ring size 6",
    ">= 1 saturated heteroatom-containing ring size 6",
    ">= 1 unsaturated or aromatic carbon-only ring size 6",
    ">= 1 unsaturated or aromatic nitrogen-containing ring size 6",
    ">= 1 unsaturated or aromatic heteroatom-containing ring size 6",
    ">= 2 any ring size 6",
    ">= 2 saturated carbon-only ring size 6",
    ">= 2 saturated nitrogen-containing ring size 6",
    ">= 2 saturated heteroatom-containing ring size 6",
    ">= 2 unsaturated or aromatic carbon-only ring size 6",
    ">= 2 unsaturated or aromatic nitrogen-containing ring size 6",
    ">= 2 unsaturated or aromatic heteroatom-containing ring size 6",
    ">= 3 any ring size 6",
    ">= 3 saturated carbon-only ring size 6",
    ">= 3 saturated nitrogen-containing ring size 6",
    ">= 3 saturated heteroatom-containing ring size 6",
    ">= 3 unsaturated or aromatic carbon-only ring size 6",
    ">= 3 unsaturated or aromatic nitrogen-containing ring size 6",
    ">= 3 unsaturated or aromatic heteroatom-containing ring size 6",
    ">= 4 any ring size 6",
    ">= 4 saturated carbon-only ring size 6",
    ">= 4 saturated nitrogen-containing ring size 6",
    ">= 4 saturated heteroatom-containing ring size 6",
    ">= 4 unsaturated or aromatic carbon-only ring size 6",
    ">= 4 unsaturated or aromatic nitrogen-containing ring size 6",
    ">= 4 unsaturated or aromatic heteroatom-containing ring size 6",
    ">= 5 any ring size 6",
    ">= 5 saturated carbon-only ring size 6",
    ">= 5 saturated nitrogen-containing ring size 6",
    ">= 5 saturated heteroatom-containing ring size 6",
    ">= 5 unsaturated or aromatic carbon-only ring size 6",
    ">= 5 unsaturated or aromatic nitrogen-containing ring size 6",
    ">= 5 unsaturated or aromatic heteroatom-containing ring size 6",
    ">= 1 any ring size 7",
    ">= 1 saturated carbon-only ring size 7",
    ">= 1 saturated nitrogen-containing ring size 7",
    ">= 1 saturated heteroatom-containing ring size 7",
    ">= 1 unsaturated or aromatic carbon-only ring size 7",
    ">= 1 unsaturated or aromatic nitrogen-containing ring size 7",
    ">= 1 unsaturated or aromatic heteroatom-containing ring size 7",
    ">= 2 any ring size 7",
    ">= 2 saturated carbon-only ring size 7",
    ">= 2 saturated nitrogen-containing ring size 7",
    ">= 2 saturated heteroatom-containing ring size 7",
    ">= 2 unsaturated or aromatic carbon-only ring size 7",
    ">= 2 unsaturated or aromatic nitrogen-containing ring size 7",
    ">= 2 unsaturated or aromatic heteroatom-containing ring size 7",
    ">= 1 any ring size 8",
    ">= 1 saturated carbon-only ring size 8",
    ">= 1 saturated nitrogen-containing ring size 8",
    ">= 1 saturated heteroatom-containing ring size 8",
    ">= 1 unsaturated or aromatic carbon-only ring size 8",
    ">= 1 unsaturated or aromatic nitrogen-containing ring size 8",
    ">= 1 unsaturated or aromatic heteroatom-containing ring size 8",
    ">= 2 any ring size 8",
    ">= 2 saturated carbon-only ring size 8",
    ">= 2 saturated nitrogen-containing ring size 8",
    ">= 2 saturated heteroatom-containing ring size 8",
    ">= 2 unsaturated or aromatic carbon-only ring size 8",
    ">= 2 unsaturated or aromatic nitrogen-containing ring size 8",
    ">= 2 unsaturated or aromatic heteroatom-containing ring size 8",
    ">= 1 any ring size 9",
    ">= 1 saturated carbon-only ring size 9",
    ">= 1 saturated nitrogen-containing ring size 9",
    ">= 1 saturated heteroatom-containing ring size 9",
    ">= 1 unsaturated or aromatic carbon-only ring size 9",
    ">= 1 unsaturated or aromatic nitrogen-containing ring size 9",
    ">= 1 unsaturated or aromatic heteroatom-containing ring size 9",
    ">= 1 any ring size 10",
    ">= 1 saturated carbon-only ring size 10",
    ">= 1 saturated nitrogen-containing ring size 10",
    ">= 1 saturated heteroatom-containing ring size 10",
    ">= 1 unsaturated or aromatic carbon-only ring size 10",
    ">= 1 unsaturated or aromatic nitrogen-containing ring size 10",
    ">= 1 unsaturated or aromatic heteroatom-containing ring size 10",
    ">= 1 aromatic ring",
    ">= 1 hetero-aromatic ring",
    ">= 2 aromatic rings",
    ">= 2 hetero-aromatic rings",
    ">= 3 aromatic rings",
    ">= 3 hetero-aromatic rings",
    ">= 4 aromatic rings",
    ">= 4 hetero-aromatic rings",
  ]

  RingSizeBaseNum = {
    3 =>  115,
    4 =>  129,
    5 =>  143,
    6 =>  178,
    7 =>  213,
    8 =>  227,
    9 =>  241,
    10 => 248,
  }
  module Molecule
    def generate_pubchem_subskey
      fp = 0
      # Section 1
      self.composition.each do |elem, num|
        HierarchicElementCounts[elem].each do |n_atoms, bit|
          fp |= (1 << bit) if num >= n_atoms
        end
      end

      # Section 2
      [143, 150, 157, 164, 171]
      s2bit = []
      sssrs = self.find_sssr.inject({}){|hash, ring| (hash[ring.size] ||= []) << ring ; hash}
      sssrs.each do |ring_size, rings|
#        base_num = case ring_size
                     
#        p [ring_size, rings.size]
#        p rings.any?{|ring| ring.any?{|atom| atom.element == :N}}
#        p rings.any?{|ring| ring.any?{|atom| atom.element != :C}}
      end

      # Section 3
      self.edges.collect{ |bond, atom1, atom2|
	[atom1.element.to_s, atom2.element.to_s].sort.join("-")
      }.uniq.each do |pair|
        fp |= (1 << Section3[pair]) if Section3[pair]
      end

      # Section 4
      self.nodes.each do |node|
        adj = self.adjacent_to(node).collect{|bond, atom| }
        p Section4[node.element]
      end
#      exit
      

      Section6.each do |smarts, bit|
        pat = Chem::OpenBabel::parse_smarts(smarts)
        fp |= (1 << bit ) if pat.match(self)
      end

      Section7.each do |smarts, bit|
        pat = Chem::OpenBabel::parse_smarts(smarts)
        fp |= (1 << bit ) if pat.match(self)
      end
      fp
    end

    # Extract PubChem  substructural keys
    # see ftp://ftp.ncbi.nlm.nih.gov/pubchem/specifications/pubchem_fingerprints.txt
    def pubchem_subskeys
      require 'base64'
      fp = 0
      b64 = self.sdf_data["PUBCHEM_CACTVS_SUBSKEYS"]
      Base64.decode64(b64).unpack("N*")[1..-1].each_with_index do |bit, idx|
#        fp += (bit << (881 - (idx + 1) * 32))
        bb = 0
        0.upto(31) do |n|
          bb += (1 << n) if (bit & (1 << (31 - n)) != 0)
        end
        fp += (bb << (idx * 32))
      end
      fp
    end

  end

end

